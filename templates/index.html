{% extends "base.html" %}

{% block title %}Weather Dashboard{% endblock %}

{% block content %}
<style>
    .weather-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.3s ease;
        overflow: hidden;
        position: relative;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .weather-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
    }

    .weather-animation {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 1;
    }

    .raindrop {
        position: absolute;
        width: 3px;
        height: 18px;
        background: linear-gradient(transparent, #66b3ff);
        animation: rain 1s linear infinite;
        transform: rotate(10deg);
    }

    .rain-splash {
        position: absolute;
        width: 8px;
        height: 4px;
        background: rgba(100, 180, 255, 0.4);
        border-radius: 50%;
        animation: splash 0.6s ease-out;
        bottom: 0;
    }

    @keyframes rain {
        0% {
            transform: translateY(-100%) rotate(5deg);
            opacity: 0;
        }

        20% {
            opacity: 1;
        }

        80% {
            opacity: 1;
        }

        100% {
            transform: translateY(100vh) rotate(15deg);
            opacity: 0;
        }
    }

    @keyframes splash {
        0% {
            transform: scale(0);
            opacity: 1;
        }

        100% {
            transform: scale(2);
            opacity: 0;
        }
    }

    .snowflake {
        position: absolute;
        font-size: 12px;
        animation: snow 8s linear infinite;
        opacity: 0.8;
        text-shadow: 0 0 5px white;
    }

    .snow-accumulate {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 0;
        background: linear-gradient(transparent, rgba(255, 255, 255, 0.8));
        animation: accumulate 10s linear forwards;
        border-radius: 0 0 20px 20px;
    }

    @keyframes snow {
        0% {
            transform: translateY(-100%) translateX(0) rotate(0deg);
        }

        50% {
            transform: translateY(50vh) translateX(50px) rotate(180deg);
        }

        100% {
            transform: translateY(100vh) translateX(0) rotate(360deg);
        }
    }

    @keyframes accumulate {
        to {
            height: 30px;
        }
    }

    .sun-core {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 60px;
        height: 60px;
        background: radial-gradient(#ffeb3b, #ffc107);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 40px rgba(255, 235, 59, 0.3);
        z-index: -5;
    }

    .sun-ray {
        position: absolute;
        width: 40px;
        height: 4px;
        background: linear-gradient(90deg, transparent, #ffeb3b);
        transform-origin: left center;
    }

    .sun-glow {
        position: absolute;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, rgba(255, 235, 59, 0.1) 0%, transparent 70%);
        animation: glow-pulse 3s ease-in-out infinite;
    }

    @keyframes rays-rotate {
        from {
            transform: rotate(0deg) translateX(30px);
        }

        to {
            transform: rotate(360deg) translateX(30px);
        }
    }

    @keyframes glow-pulse {

        0%,
        100% {
            opacity: 0.3;
        }

        50% {
            opacity: 0.6;
        }
    }

    .wind-line {
        position: absolute;
        height: 2px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        animation: wind-move 4s ease-in-out infinite;
        opacity: 0.7;
    }

    .cloud {
        position: absolute;
        color: rgba(255, 255, 255, 0.7);
        animation: moveCloud 20s linear infinite;
        white-space: nowrap;
        z-index: 0;
    }

    @keyframes wind-move {
        0% {
            transform: translateX(-100%) translateY(0px) rotate(0deg);
            opacity: 0;
        }

        20% {
            opacity: 1;
        }

        50% {
            transform: translateX(50%) translateY(3px) rotate(2deg);
        }

        80% {
            opacity: 1;
        }

        100% {
            transform: translateX(100vw) translateY(-3px) rotate(-2deg);
            opacity: 0;
        }
    }

    @keyframes moveCloud {
        0% {
            transform: translateX(0);
        }

        100% {
            transform: translateX(80vw);
        }
    }

    .weather-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .temp-display {
        font-size: 3.5rem;
        font-weight: 700;
        line-height: 1;
        user-select: none;
    }

    .weather-detail {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        padding: 0.5rem;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
</style>

<div class="container-fluid px-4 py-5 mt-4">
    <div class="row justify-content-around flex-wrap gy-5">
        <div class="col-lg-6">
            <div class="sticky-top" style="top: 90px;">
                <h2 class="mb-4 user-select-none"><i class="fas fa-search me-2"></i>Search Weather</h2>
                <form method="POST" action="/home" class="mb-4">
                    <div class="input-group input-group-lg shadow-lg">
                        <input type="text" name="city" class="form-control form-control-lg"
                            placeholder="Enter city name" required>
                        <button class="btn btn-primary px-4">
                            <i class="fas fa-search me-2"></i>Search
                        </button>
                    </div>
                </form>

                {% if weather %}
                <div class="weather-card p-4 p-md-5 position-relative mb-4">
                    <div class="position-relative" style="z-index: 2">
                        <div class="text-center mb-4">
                            <h1 class="display-4 mb-3">{{ weather.name }}</h1>
                            <div class="temp-display">{{ weather.main.temp }}¬∞C</div>
                            <div class="text-capitalize h4 mt-2 user-select-none">{{ weather.weather[0].description }}</div>
                        </div>

                        <div class="row g-3 text-center user-select-none">
                            <div class="col-6 col-md-3 d-flex">
                                <div class="weather-detail w-100">
                                    <div class="h5 mb-1">üå°Ô∏è {{ weather.main.feels_like }}¬∞C</div>
                                    <small class="text-muted">Feels Like</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-3 d-flex">
                                <div class="weather-detail w-100">
                                    <div class="h5 mb-1">üíß {{ weather.main.humidity }}%</div>
                                    <small class="text-muted">Humidity</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-3 d-flex">
                                <div class="weather-detail w-100">
                                    <div class="h5 mb-1">üå¨Ô∏è {{ weather.wind.speed }} m/s</div>
                                    <small class="text-muted">Wind</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-3 d-flex">
                                <div class="weather-detail w-100">
                                    <div class="h5 mb-1">üîÜ {{ weather.main.pressure }} hPa</div>
                                    <small class="text-muted">Pressure</small>
                                </div>
                            </div>
                        </div>

                        {% if current_user.is_authenticated %}
                        <form method="POST" action="/add_favorite" class="mt-5 text-center">
                            <input type="hidden" name="city_name" value="{{ weather.name }}">
                            <button class="btn btn-primary btn-lg px-4 py-2">
                                <i class="fas fa-star me-2"></i>Add to Favorites
                            </button>
                        </form>
                        {% endif %}
                    </div>

                    <div class="weather-animation">
                        {% if 'rain' in weather.weather[0].description.lower() %}
                        {% for i in range(60) %}
                        <div class="raindrop" style="
                                left: {{ range(0, 100)|random }}%; 
                                height: {{ range(10, 25)|random }}px; 
                                animation-delay: {{ -(range(1000, 1500)|random) / 1000.0 }}s;
                                animation-duration: {{ (range(70, 100)|random) / 100.0 }}s;">
                        </div>
                        <div class="rain-splash" style="
                                left: {{ range(0, 100)|random }}%;
                                animation-delay: {{ (range(1000, 1500)|random) / 1000.0 }}s;
                            "></div>
                        {% endfor %}
                        {% endif %}
                    
                        {% if 'snow' in weather.weather[0].description.lower() %}
                        {% for i in range(40) %}
                        <div class="snowflake" style="
                                left: {{ range(0, 100)|random }}%;
                                animation-duration: {{ range(5, 10)|random }}s;
                                animation-delay: {{ range(0, 5)|random }}s;
                                top: -5%;
                                font-size: {{ range(12, 18)|random }}px;
                            ">‚ùÑÔ∏è</div>
                        {% endfor %}
                        <div class="snow-accumulate"></div>
                        {% endif %}
                    
                        {% if 'cloud' in weather.weather[0].description.lower() and weather.main.temp < 35 %}
                        {% for i in range(5) %}
                        <div class="cloud" style="
                                top: {{ range(10, 40)|random }}%;
                                left: -{{ range(10, 30)|random}}%;
                                font-size: {{ range(30, 60)|random }}px;
                                animation-duration: {{ range(10, 25)|random }}s;
                                animation-delay: -{{ range(10, 25) | random }}s;
                                transform: translateX(-{{ range(100, 500)|random }}px);">‚òÅÔ∏è</div>
                        {% endfor %}
                        {% endif %}
                    
                        {% if weather.wind.speed > 1.5 and weather.main.temp < 35 and 'snow' not in weather.weather[0].description.lower() %}
                        {% for i in range(8) %}
                        <div class="wind-line" style="
                                top: {{ range(20, 80)|random }}%;
                                left: {{ range(10, 90)|random }}%;
                                width: {{ range(30, 60)|random }}%;
                                animation-duration: {{ range(1, 3)|random }}s;
                            "></div>
                        {% endfor %}
                        {% endif %}
                    
                        {% if weather.main.temp > 35 %}
                        <div class="sun-glow"></div>
                        <div class="sun-core"></div>
                        {% if 'rain' not in weather.weather[0].description.lower() %}
                        {% for i in range(12) %}
                        <div class="sun-ray" style="
                                transform: rotate({{ 30 * i }}deg) translateX(30px);
                                animation: rays-rotate 20s linear infinite;
                                animation-delay: -{{ (30 * i / 360) * 20 }}s;
                        "></div>
                        {% endfor %}
                        {% endif %}
                        {% for i in range(8) %}
                        <div class="wind-line" style="
                                top: {{ range(20, 80)|random }}%;
                                left: {{ range(10, 90)|random }}%;
                                width: {{ range(20, 40)|random }}%;
                                animation-duration: {{ range(1, 3)|random }}s;
                                background: rgba(255,204,0,0.3);
                            "></div>
                        {% endfor %}
                        {% endif %}
                    </div>                    
                </div>
                {% else %}
                <div class="weather-card p-5 text-center">
                    <i class="fas fa-cloud-sun fa-4x text-muted mb-4"></i>
                    <h3 class="mb-3">Search for a city</h3>
                    <p class="text-white">Enter a city name to get current weather information</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="col-lg-3">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0"><i class="fas fa-star me-2"></i>Favorites</h4>
                <span class="badge bg-primary rounded-pill">{{ favorite_cities|length }}</span>
            </div>

            {% if favorite_cities %}
            <div class="row g-3">
                {% for city in favorite_cities %}
                <div class="col-12">
                    <div class="weather-card p-3 position-relative">
                        <div class="position-relative" style="z-index: 2">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h5 class="mb-0">{{ city.name }}</h5>
                                <form method="post" action="/delete_favorite/{{city.name}}">
                                    <button class="btn btn-danger btn-sm rounded-circle">&times;</button>
                                </form>
                            </div>
                            <div class="d-flex flex-column align-items-center">
                                <div class="temp-display me-3">{{ city.main.temp }}¬∞</div>
                                <div>
                                    <div class="text-capitalize user-select-none">{{ city.weather[0].description }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="weather-animation">
                            {% if 'rain' in city.weather[0].description.lower() %}
                            {% for i in range(60) %}
                            <div class="raindrop" style="
                                    left: {{ range(0, 100)|random }}%; 
                                    height: {{ range(10, 25)|random }}px; 
                                    animation-delay: {{ -(range(1000, 1500)|random) / 1000.0 }}s;
                                    animation-duration: {{ (range(70, 100)|random) / 100.0 }}s;">
                            </div>
                            <div class="rain-splash" style="
                                    left: {{ range(0, 100)|random }}%;
                                    animation-delay: {{ (range(1000, 1500)|random) / 1000.0 }}s;
                                "></div>
                            {% endfor %}
                            {% endif %}
                        
                            {% if 'snow' in city.weather[0].description.lower() %}
                            {% for i in range(40) %}
                            <div class="snowflake" style="
                                    left: {{ range(0, 100)|random }}%;
                                    animation-duration: {{ range(5, 10)|random }}s;
                                    animation-delay: {{ range(0, 5)|random }}s;
                                    top: -5%;
                                    font-size: {{ range(12, 18)|random }}px;
                                ">‚ùÑÔ∏è</div>
                            {% endfor %}
                            <div class="snow-accumulate"></div>
                            {% endif %}
                        
                            {% if 'cloud' in city.weather[0].description.lower() and city.main.temp < 35 %}
                            {% for i in range(5) %}
                            <div class="cloud" style="
                                    top: {{ range(10, 40)|random }}%;
                                    left: -{{ range(10, 30)|random}}%;
                                    font-size: {{ range(30, 60)|random }}px;
                                    animation-duration: {{ range(10, 25)|random }}s;
                                    animation-delay: -{{ range(10, 25) | random }}s;
                                    transform: translateX(-{{ range(100, 500)|random }}px);">‚òÅÔ∏è</div>
                            {% endfor %}
                            {% endif %}
                        
                            {% if city.wind.speed > 1.5 and city.main.temp < 35 and 'snow' not in city.weather[0].description.lower() %}
                            {% for i in range(8) %}
                            <div class="wind-line" style="
                                    top: {{ range(20, 80)|random }}%;
                                    left: {{ range(10, 90)|random }}%;
                                    width: {{ range(30, 60)|random }}%;
                                    animation-duration: {{ range(1, 3)|random }}s;
                                "></div>
                            {% endfor %}
                            {% endif %}
                        
                            {% if city.main.temp > 35 %}
                            <div class="sun-glow"></div>
                            <div class="sun-core"></div>
                            {% if 'rain' not in city.weather[0].description.lower() %}
                            {% for i in range(12) %}
                            <div class="sun-ray" style="
                                    transform: rotate({{ 30 * i }}deg) translateX(30px);
                                    animation: rays-rotate 20s linear infinite;
                                    animation-delay: -{{ (30 * i / 360) * 20 }}s;
                            "></div>
                            {% endfor %}
                            {% endif %}
                            {% for i in range(8) %}
                            <div class="wind-line" style="
                                    top: {{ range(20, 80)|random }}%;
                                    left: {{ range(10, 90)|random }}%;
                                    width: {{ range(20, 40)|random }}%;
                                    animation-duration: {{ range(1, 3)|random }}s;
                                    background: rgba(255,204,0,0.3);
                                "></div>
                            {% endfor %}
                            {% endif %}
                        </div>                        
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-star fa-3x text-muted mb-3"></i>
                <p class="text-muted">No favorite cities yet. Search and add some!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.weather-card').forEach(card => {
        card.addEventListener('mouseenter', () => {
            const animation = card.querySelector('.weather-animation');
            if (animation) {
                animation.style.filter = 'brightness(1.2)';
            }
        });

        card.addEventListener('mouseleave', () => {
            const animation = card.querySelector('.weather-animation');
            if (animation) {
                animation.style.filter = 'brightness(1)';
            }
        });
    });

    document.querySelectorAll('.raindrop').forEach(drop => {
        drop.addEventListener('animationend', () => {
            const splash = drop.nextElementSibling;
            splash.style.animation = 'none';
            void splash.offsetWidth;
            splash.style.animation = null;
        });
    });
</script>
{% endblock %}
